name: Release
run-name: Release @ Aegis Icons - ${{ github.sha }}

on:
  schedule:
    - cron: "0 0 1 * *"   # 00:00 UTC on the 1st of each month
  workflow_dispatch:

env:
  zipname: aegis-icons.zip

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest

    steps:
      - name: Get current date
        run: |
          echo "DATE_ISO=$(date +'%Y-%m-%d')" >> $GITHUB_ENV
          echo "DATE_INT=$(date +'%Y%m%d')" >> $GITHUB_ENV

      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Execute py script (gen-def)
        run: python make-pack.py gen-def

      - name: Commit json
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: Update pack.json

      - name: Execute py script (generate ZIP)
        run: python make-pack.py gen --output ${{ env.zipname }} --version ${{ env.DATE_INT }}

      - name: Create a GitHub release
        uses: softprops/action-gh-release@v0.1.15
        with:
          files: ${{ env.zipname }}
          name: ${{ env.DATE_ISO }}
          tag_name: ${{ env.DATE_ISO }}
          body: |
            #### :question: Didn't find an icon from the pack? [Check it from our website](https://aegis-icons.github.io) first before making new issues!

            ### :package: [Latest ZIP Download](https://github.com/aegis-icons/aegis-icons/releases/latest/download/aegis-icons.zip) 

            #### :memo: Help how to: [install](https://github.com/aegis-icons/aegis-icons/blob/master/FAQ.md#with-icon-pack) â€¢ [update](https://github.com/aegis-icons/aegis-icons/blob/master/FAQ.md#how-to-update-the-icon-pack)

            ---
